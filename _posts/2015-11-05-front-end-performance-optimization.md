---
layout: post
title: "前端性能优化"
date: 2015-11-05
---

前端性能优化是前端工程师的一大重要价值体现，在这方面不断的有人前赴后继的寻找更好的优化方案。

在性能优化这方面，yahoo前端性能团队算是业界做得最好的了。

<img src="/images/articles/front-end-performance-optimization-1.png" alt="" />

我个人对性能优化的总结是：

### 减少http请求

我们知道http请求来源于客户端对服务器的资源请求，比如一个网页中的html代码、css文件、js文件、图片文件、ajax请求。而大部分浏览器响应耗时都花费在请求资源，所以减少http请求对于提高网页的加载速度是非常重要的。具体关于http的知识可以参考happypeter的翻译的书籍 — [《HTTP下午茶》](http://happypeter.github.io/tealeaf-http/)

最典型的前端减少http请求，有拼合css sprite图，孤傲的我，几乎没玩过PS操作这个，看来作为一个前端PS技术也是要拿得出手的。css、js文件合并也是我们一般都会用到的，不过现在nodejs盛行，大多前端团队都是基于nodejs构建的。而nodejs给前端带来了太多的工具，比如gulp，这里不说grunt是因为grunt配置文件的编写实在是有些晦涩难懂，这里不多做讨论。

静态资源缓存这一块，一般都是通过配置服务器的相关选项来实现的。然而这样会引发一个新的问题，就是当文件更新的时候，怎么让做了更改的文件缓存更新，并避免那些没有做过修改的文件缓存不失效。通常现在的前端团队会利用query的形式来修改链接

	<script src="test.js?v=0.1.0"></script>

但是对于大型应用来说，这其中还存在一个新的问题。当页面做了修改后，发布修改后的html文件和test.js?v=0.1.1文件总会有一个先后顺序。这中间会产生一个小小的间隔，大型应用每时每刻都存在用户访问，所以会存在用户看到错误页面的情况。这是不被允许的，当然也有公司选择在凌晨用户都睡觉去的时候发布，但这解决办法怎么都感觉不靠谱。最优的解决办法是利用基于文件内容的hash版本冗余机制，而不是传统的替换文件链接地址。

hash版本冗余机制是怎么做的呢？

	<script src="test_8467a32.js"></script>

_8467a32这个字符串就是根据test.js文件内容进行hash运算得到的，所以当文件内容改变的时候，字符串也会相应的改变。所以，可以先上传静态资源，这样等上传html时，就能找到相应的静态资源文件了。这时候我们会发现，线上多了一个新文件，那么老的文件怎么办呢？可以研究一下百度的[FIS](http://fis.baidu.com/)前端工程构建工具是怎么做的

当然在利用CDN加速可以有效的减少服务器的压力，所以一般大公司都会有自己的静态资源服务器或者CDN加速服务器之类的。

### 压缩代码

压缩代码是每个项目上线的时候都要经过的一个流程，前面提到的Gulp就是一个比较好的解决方案，还有[FIS](http://fis.baidu.com/)。好吧，我承认我比较推崇百度的这款工具，虽然我不太熟悉它的使用以及原理，但给我的感觉是“业界良心产品”呀！

### 优化代码结构

对于有强烈的代码洁癖的我来说，最讨厌那种low到爆的代码了，因为不能容忍，所以正在努力试着写出优雅高效的代码。就好像喝咖啡一样，你不能容忍使用一个丑的不行的杯子。

当然，高效的代码可以提高程序的执行效率，不过这一般都是长时间的经验积累和折腾出来的，并非有特别的技巧或者说某某某直接告诉你，高效的代码应该是怎样写的。我认为这应该是一种思维方式的问题，站在计算机的角度在思考，自然很容易写出好的代码。

### 避免页面多次跳转

存在这样一种情况，用户本来要看a页面的，但是由于用户的权限还不够或者说未执行某个前提操作，导致location定位到另一个页面b。这又是一次页面请求，甚至还有更变态的，页面连续跳转了n次，导致用户看到的一直都是空白页（浏览器在加载中~）。

### 延迟加载和提前加载

延迟加载最典型的例子就是[花瓣网](http://huaban.com/)，在多图展示的情况下，利用延迟加载（按需加载）可以避免一次加载负重过大导致的性能问题。当用户屏幕滚动到下一批图片的时候，再去加载相应的图片文件。其实这里我在想，能不能同时利用是提前加载呢？或者花瓣网等本来就是延迟加载+提前加载，只是我没发现而已。

提前加载

相信有用过手机看小说的都能理解，UC浏览器至少一直都是这么做的，提前加载好用户下次可能会访问的页面，比如小说的下一章（甚至下面几章）。那么同理，还是来看花瓣网，在页面加载完毕的时候，能否预先加载好用户可能会查看的下一屏的图片文件。首屏加载完毕且用户还在浏览的时候，浏览器是出于“休息”状态的，如果这时候加载好用户可能会访问的下一屏的文件，怎么都觉得这是一个非常棒的思路。

### 减少DOM元素

关于这个话题，还要牵扯到最近火的不行的react。react觉得前端页面构建的时候，加载DOM花费了大量的时间，耗费浏览器性能。于是提出了一套虚拟DOM的思路，具体是否有多高效，我暂时没有研究过。有时间可以去看下[阮一峰](http://www.ruanyifeng.com/blog/2015/03/react.html)前辈的react相关博文。

> 关于更多更详细的前端优化资料，可以看下Yahoo前端的[这篇文章](https://developer.yahoo.com/performance/rules.html)

