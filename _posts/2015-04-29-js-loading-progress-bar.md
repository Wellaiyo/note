---
layout: post
title: 'JS模拟页面加载进度'
date: 2015-04-29
---

一直看到有些网站有加载进度的样式，很cool的样子，也很纳闷~  按照js无法识别资源加载进度的道理来算，这是根本就是无法实现的。

对，确实无法实现，但可以模拟。脑洞大开的开发者们让我感觉到世界满满的邪恶味道！

JS模拟页面加载进度的实现原理其实非常简单，对页面性能优化稍有了解的人都应该知道，拿到请求的资源后，页面渲染的一个过程是怎样的。ok，这里可以下手。我们一般所认为的页面加载完毕是指首屏页面显示完毕了，然后加载样式不转动了（处于停止状态）。所以，一般来说，只要head里面的外联css, js文件加载完毕了，页面就差不多了，这些都是可控的。

实际操作：

首先，在head中（所有css, js外联文件的前面，越前越好）添加script标签，用来编写我们的主要实现程序。这里说外联文件，是因为内联文件的加载速度几乎可以忽略。

css文件加载完毕监测：

在css文件中的最后一行添加一个样式，然后在html中给这个样式添加相应的DOM节点，比如：

	// css
	#for_load {font-size:0;}
	
	// html
	<span id="for_load"></span>

最后在主程序中写个轮询，当监测到id为for_load的DOM元素的font-size为0时，说明该css文件加载执行完毕了。

同样的道理，在js的最后一行，给window或者其它的全局对象添加一个属性，然后监控其值得变化：

	window.for_load = true;

如果window.for_load值为true时，说明该js文件已经加载完毕了。

有多少个css、js文件，我们都是清楚的，所以加载进度的百分比大概就出来了。

而且，因为加载的速度是非常快的，所以我们只要设定好几个关键的点就可以搞定了。
